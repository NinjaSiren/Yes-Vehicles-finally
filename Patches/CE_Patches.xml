<?xml version="1.0" encoding="utf-8" ?>
<Patch>
    
	<!-- Patch operation for CE Compatibility -->
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Combat Extended</li>
        </mods>
		
        <match Class="PatchOperationSequence">
            <success>Always</success>
            <operations>
			
                <!-- Adds explosion and explosion damage on the tank projectile -->
                <li Class="PatchOperationInsert">
                    <xpath>Defs/ThingDef[defName="Bullet_20x110mmHispano_HE"]</xpath>
                        <value>
                            <li Class="CombatExtended.CompProperties_ExplosiveCE">
                                <explosionDamage>50</explosionDamage>
                                <explosionDamageDef>Flame</explosionDamageDef>
                                <explosionRadius>2.5</explosionRadius>
                                <applyDamageToExplosionCellsNeighbors>true</applyDamageToExplosionCellsNeighbors>
                                <chanceToStartFire>0.2</chanceToStartFire>
                                <damageFalloff>true</damageFalloff>
                            </li>
                        </value>
                </li>
           
                <!-- Adds CE compatibility with vehicle melee -->
                <li Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="APC"]/tools</xpath>
                        <value>
                            <tools>
                                <li Class="CombatExtended.ToolCE">
                                    <label>body</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>25</power>
                                    <cooldownTime>2.6</cooldownTime>
                                    <linkedBodyPartsGroup>HeadAttackTool</linkedBodyPartsGroup>
                                    <chanceFactor>1.5</chanceFactor>
                                    <armorPenetration>1.0</armorPenetration>
                                    <ensureLinkedBodyPartsGroupAlwaysUsable>true</ensureLinkedBodyPartsGroupAlwaysUsable>
                                </li>
                            </tools>
                        </value>
                </li>
           
                <li Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="ATV"]/tools</xpath>
                        <value>
                            <tools>
                                <li Class="CombatExtended.ToolCE">
                                    <label>body</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>25</power>
                                    <cooldownTime>2.6</cooldownTime>
                                    <linkedBodyPartsGroup>HeadAttackTool</linkedBodyPartsGroup>
                                    <chanceFactor>1.5</chanceFactor>
                                    <armorPenetration>1.0</armorPenetration>
                                    <ensureLinkedBodyPartsGroupAlwaysUsable>true</ensureLinkedBodyPartsGroupAlwaysUsable>
                                </li>
                            </tools>
                        </value>
                </li>
           
                <li Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="Tank"]/tools</xpath>
                        <value>
                            <tools>
                                <li Class="CombatExtended.ToolCE">
                                    <label>body</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>25</power>
                                    <cooldownTime>2.6</cooldownTime>
                                    <linkedBodyPartsGroup>HeadAttackTool</linkedBodyPartsGroup>
                                    <chanceFactor>1.5</chanceFactor>
                                    <armorPenetration>1.0</armorPenetration>
                                    <ensureLinkedBodyPartsGroupAlwaysUsable>true</ensureLinkedBodyPartsGroupAlwaysUsable>
                                </li>
                            </tools>
                        </value>
                </li>
           
                <li Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="Truck"]/tools</xpath>
                        <value>
                            <tools>
                                <li Class="CombatExtended.ToolCE">
                                    <label>body</label>
                                    <capacities>
                                        <li>Blunt</li>
                                    </capacities>
                                    <power>25</power>
                                    <cooldownTime>2.6</cooldownTime>
                                    <linkedBodyPartsGroup>HeadAttackTool</linkedBodyPartsGroup>
                                    <chanceFactor>1.5</chanceFactor>
                                    <armorPenetration>1.0</armorPenetration>
                                    <ensureLinkedBodyPartsGroupAlwaysUsable>true</ensureLinkedBodyPartsGroupAlwaysUsable>
                                </li>
                            </tools>
                        </value>
                </li>
               
                <!-- Rail Cannon CE Patch -->  
                <li Class="PatchOperationReplace">
				    <xpath>/Defs/ThingDef[defName="Rail_Cannon"]</xpath>
				    <value>
                        <ThingDef ParentName="Rail_CannonBase">
                            <defName>Rail_Cannon</defName>
		                    <label>Rail cannon</label>
		                    <description>A pin point cannon capable of delivering a dense round down the battlefield quickly.</description>
		                    <graphicData>
			                    <texPath>Box/Rail_Cannon</texPath>
			                    <graphicClass>Graphic_Single</graphicClass>
			                    <onGroundRandomRotateAngle>0</onGroundRandomRotateAngle>
		                    </graphicData>
		                    <soundInteract>InteractPistol</soundInteract>
		                    <statBases>
                                <WorkToMake>10000</WorkToMake>
			                    <Mass>8.85</Mass>
			                    <MarketValue>5200</MarketValue>
			                    <AccuracyTouch>0.98</AccuracyTouch>
			                    <AccuracyShort>0.72</AccuracyShort>
			                    <AccuracyMedium>0.95</AccuracyMedium>
			                    <AccuracyLong>0.97</AccuracyLong>
			                    <RangedWeapon_Cooldown>3.0</RangedWeapon_Cooldown>
		                    </statBases>
		                    <costList>
			                    <Steel>150</Steel>
			                    <Plasteel>80</Plasteel>
			                    <ComponentIndustrial>15</ComponentIndustrial>
		                    </costList>
                            <recipeMaker>
                                <skillRequirements>
                                    <Crafting>9</Crafting>
                                </skillRequirements>
                            </recipeMaker>
		                    <weaponTags>
			                    <li>Heavy_Weps</li>								
                                <li>CE_AI_Rifle</li>
                                <li>EliteGun</li>
		                    </weaponTags>
						    <verbs>
						        <li Class="CombatExtended.VerbPropertiesCE">
                                    <recoilAmount>2.15</recoilAmount>
                                    <verbClass>CombatExtended.Verb_ShootCE</verbClass>
                                    <hasStandardCommand>true</hasStandardCommand>
                                    <defaultProjectile>Bullet_20x110mmHispano_FMJ</defaultProjectile>
                                    <range>75</range>
                                    <soundCast>RailCannon_Fire</soundCast>
                                    <soundCastTail>GunTail_Heavy</soundCastTail>
                                    <muzzleFlashScale>40</muzzleFlashScale>
						        </li>
						    </verbs>
						    <comps>
                                <!-- Leaving this here in case of weapon ammo limits. -->
							    <!--li Class="CombatExtended.CompProperties_AmmoUser">
                                    <magazineSize>40</magazineSize>
                                    <reloadTime>7</reloadTime>
                                    <ammoSet>AmmoSet_20x110mmHispano</ammoSet>
							    </li-->
							    <li Class="CombatExtended.CompProperties_FireModes">
                                    <aiUseBurstMode>FALSE</aiUseBurstMode>
                                    <aiAimMode>AimedShot</aiAimMode>
							    </li>
						    </comps>	
					    </ThingDef>
				    </value>
			    </li>
           
                <!-- Tank Cannon CE Patch -->  
                <li Class="PatchOperationReplace">
				    <xpath>/Defs/ThingDef[defName="Tank_Cannon"]</xpath>
				    <value>
                        <ThingDef ParentName="Tank_CannonBase">
                            <defName>Tank_Cannon</defName>
		                    <label>Tank cannon</label>
		                    <description>A powerful cannon for use on a tank, capable of sending exploding shells accurately at the enemy.</description>
		                    <graphicData>
		                    	<texPath>Box/Tank_Cannon</texPath>
		                    	<graphicClass>Graphic_Single</graphicClass>
		                    	<onGroundRandomRotateAngle>0</onGroundRandomRotateAngle>
		                    </graphicData>
		                    <soundInteract>InteractPistol</soundInteract>
		                    <statBases>
                                <WorkToMake>8000</WorkToMake>
		                    	<Mass>7.85</Mass>
		                    	<MarketValue>4200</MarketValue>
		                    	<AccuracyTouch>0.98</AccuracyTouch>
		                    	<AccuracyShort>0.87</AccuracyShort>
		                    	<AccuracyMedium>0.95</AccuracyMedium>
		                    	<AccuracyLong>0.92</AccuracyLong>
		                    	<RangedWeapon_Cooldown>2.5</RangedWeapon_Cooldown>
		                    </statBases>
		                    <costList>
		                    	<Steel>150</Steel>
		                    	<Plasteel>40</Plasteel>
		                    	<ComponentIndustrial>5</ComponentIndustrial>
		                    </costList>
                            <recipeMaker>
                                <skillRequirements>
                                    <Crafting>7</Crafting>
                                </skillRequirements>
                            </recipeMaker>
		                    <weaponTags>
			                    <li>Heavy_Weps</li>							
                                <li>CE_AI_Rifle</li>
                                <li>EliteGun</li>
		                    </weaponTags>
						    <verbs>
						        <li Class="CombatExtended.VerbPropertiesCE">
                                    <recoilAmount>3.02</recoilAmount>
                                    <verbClass>CombatExtended.Verb_ShootCE</verbClass>
                                    <hasStandardCommand>true</hasStandardCommand>
                                    <defaultProjectile>Bullet_20x110mmHispano_HE</defaultProjectile>
                                    <range>65</range>
                                    <soundCast>TankCannon_Fire</soundCast>
                                    <soundCastTail>GunTail_Heavy</soundCastTail>
                                    <muzzleFlashScale>50</muzzleFlashScale>
                                    <targetParams>
                                        <canTargetLocations>true</canTargetLocations>
                                    </targetParams>
						        </li>
						    </verbs>
						    <comps>
                                <!-- Leaving this here in case of weapon ammo limits. -->
							    <!--li Class="CombatExtended.CompProperties_AmmoUser">
                                    <magazineSize>40</magazineSize>
                                    <reloadTime>5</reloadTime>
                                    <ammoSet>AmmoSet_20x110mmHispano</ammoSet>
							    </li-->
							    <li Class="CombatExtended.CompProperties_FireModes">
                                    <aiUseBurstMode>FALSE</aiUseBurstMode>
                                    <aiAimMode>AimedShot</aiAimMode>
							    </li>
						    </comps>	
					    </ThingDef>
				    </value>
			    </li>
 
                <!-- Burst Cannon CE Patch -->
                <li Class="PatchOperationReplace">
				    <xpath>/Defs/ThingDef[defName="Burst_Cannon"]</xpath>
				    <value>
                        <ThingDef ParentName="Burst_CannonBase">
                            <defName>Burst_Cannon</defName>
		                    <label>Burst cannon</label>
		                    <description>A rapid fire cannon for light armor or infantry.</description>
		                    <graphicData>
		                    	<texPath>Box/Burst_Cannon</texPath>
		                    	<graphicClass>Graphic_Single</graphicClass>
		                    	<onGroundRandomRotateAngle>0</onGroundRandomRotateAngle>
		                    </graphicData>
		                    <soundInteract>InteractPistol</soundInteract>
		                    <statBases>
                            	<WorkToMake>6000</WorkToMake>
			                	<Mass>6.85</Mass>
			                	<MarketValue>3200</MarketValue>
			                	<AccuracyTouch>0.90</AccuracyTouch>
			                	<AccuracyShort>0.73</AccuracyShort>
			                	<AccuracyMedium>0.80</AccuracyMedium>
			                	<AccuracyLong>0.67</AccuracyLong>
			                	<RangedWeapon_Cooldown>1.8</RangedWeapon_Cooldown>
		                    </statBases>
		                    <costList>
		                    	<Steel>100</Steel>
		                    	<ComponentIndustrial>5</ComponentIndustrial>
		                    </costList>
                            <recipeMaker>
                                <skillRequirements>
                                    <Crafting>5</Crafting>
                                </skillRequirements>
                            </recipeMaker>
		                    <weaponTags>
			                    <li>Light_Weps</li>							
                                <li>CE_AI_Rifle</li>
                                <li>EliteGun</li>
		                    </weaponTags>
						    <verbs>
						        <li Class="CombatExtended.VerbPropertiesCE">
                                    <recoilAmount>1.51</recoilAmount>
                                    <verbClass>CombatExtended.Verb_ShootCE</verbClass>
                                    <hasStandardCommand>true</hasStandardCommand>
                                    <defaultProjectile>Bullet_20x82mmMauser_HE</defaultProjectile>         
                                    <warmupTime>0.56</warmupTime>
                                    <range>55</range>
                                    <soundCast>BurstCannon_Fire</soundCast>
                                    <soundCastTail>GunTail_Heavy</soundCastTail>
                                    <muzzleFlashScale>20</muzzleFlashScale>
                                    <burstShotCount>75</burstShotCount>
                                    <ticksBetweenBurstShots>4</ticksBetweenBurstShots>
						        </li>
						    </verbs>
						    <comps>
                                <!-- Leaving this here in case of weapon ammo limits. -->
							    <!--li Class="CombatExtended.CompProperties_AmmoUser">
                                    <magazineSize>60</magazineSize>
                                    <reloadTime>1</reloadTime>
                                    <ammoSet>AmmoSet_20x82mmMauser</ammoSet>
							    </li-->
							    <li Class="CombatExtended.CompProperties_FireModes">
                                    <aiUseBurstMode>TRUE</aiUseBurstMode>
                                    <noSingleShot>true</noSingleShot>
                                    <aimedBurstShotCount>75</aimedBurstShotCount> 
							    </li>
						    </comps>	
					    </ThingDef>
				    </value>
			    </li>
				
                <!-- Machine Cannon CE Patch -->
                <li Class="PatchOperationReplace">
				    <xpath>/Defs/ThingDef[defName="Machine_Cannon"]</xpath>
				    <value>
                        <ThingDef ParentName="Machine_CannonBase">
		                    <defName>Machine_Cannon</defName>
		                    <label>Machine cannon</label>
		                    <description>An ultra rapid fire cannon for infantry and animal attacks.</description>
		                    <graphicData>
		                    	<texPath>Box/Burst_Cannon</texPath>
		                    	<graphicClass>Graphic_Single</graphicClass>
		                    	<onGroundRandomRotateAngle>0</onGroundRandomRotateAngle>
		                    </graphicData>
		                    <soundInteract>InteractPistol</soundInteract>
		                    <statBases>
                                <WorkToMake>4000</WorkToMake>
		                    	<Mass>5.65</Mass>
		                    	<MarketValue>2800</MarketValue>
		                    	<AccuracyTouch>0.97</AccuracyTouch>
		                    	<AccuracyShort>0.97</AccuracyShort>
		                    	<AccuracyMedium>0.67</AccuracyMedium>
		                    	<AccuracyLong>0.37</AccuracyLong>
		                    	<RangedWeapon_Cooldown>1.8</RangedWeapon_Cooldown>
		                    </statBases>
		                    <costList>
		                    	<Steel>100</Steel>
		                    	<ComponentIndustrial>5</ComponentIndustrial>
		                    </costList>
                            <recipeMaker>
                                <skillRequirements>
                                    <Crafting>3</Crafting>
                                </skillRequirements>
                            </recipeMaker>
		                    <weaponTags>
			                    <li>Light_Weps</li>							
                                <li>CE_AI_Rifle</li>
                                <li>EliteGun</li>
		                    </weaponTags>
						    <verbs>
						        <li Class="CombatExtended.VerbPropertiesCE">
                                    <recoilAmount>1.58</recoilAmount>
                                    <verbClass>CombatExtended.Verb_ShootCE</verbClass>
                                    <hasStandardCommand>true</hasStandardCommand>
                                    <defaultProjectile>Bullet_127x55mmAR_FMJ</defaultProjectile>               
                                    <warmupTime>0.36</warmupTime>
                                    <range>45</range>
                                    <soundCast>BurstCannon_Fire</soundCast>
                                    <soundCastTail>GunTail_Heavy</soundCastTail>
                                    <muzzleFlashScale>20</muzzleFlashScale>
                                    <burstShotCount>150</burstShotCount>
                                    <ticksBetweenBurstShots>2</ticksBetweenBurstShots>
						        </li>
						    </verbs>
						    <comps>
                                <!-- Leaving this here in case of weapon ammo limits. -->
							    <!--li Class="CombatExtended.CompProperties_AmmoUser">
                                    <magazineSize>120</magazineSize>
                                    <reloadTime>0.75</reloadTime>
                                    <ammoSet>AmmoSet_127x55mmAR</ammoSet>
							    </li-->
							    <li Class="CombatExtended.CompProperties_FireModes">
                                    <aiUseBurstMode>TRUE</aiUseBurstMode>
                                    <noSingleShot>true</noSingleShot>
                                    <aimedBurstShotCount>150</aimedBurstShotCount>
							    </li>
						    </comps>	
					    </ThingDef>
				    </value>
			    </li>				
				
                <!-- Machine Gun CE Patch -->
                <li Class="PatchOperationReplace">
				    <xpath>/Defs/ThingDef[defName="Machine_Gun"]</xpath>
				    <value>
                        <ThingDef ParentName="Machine_GunBase">
		                    <defName>Machine_Gun</defName>
		                    <label>Machine gun</label>
		                    <description>An ultra rapid fire gun for infantry and animal attacks.</description>
		                    <graphicData>
		                    	<texPath>Box/Burst_Cannon</texPath>
		                    	<graphicClass>Graphic_Single</graphicClass>
		                    	<onGroundRandomRotateAngle>0</onGroundRandomRotateAngle>
		                    </graphicData>
		                    <soundInteract>InteractPistol</soundInteract>
		                    <statBases>
                                <WorkToMake>2000</WorkToMake>
		                    	<Mass>2.65</Mass>
			                    <MarketValue>2400</MarketValue>
			                    <AccuracyTouch>0.97</AccuracyTouch>
			                    <AccuracyShort>0.90</AccuracyShort>
			                    <AccuracyMedium>0.30</AccuracyMedium>
			                    <AccuracyLong>0.15</AccuracyLong>
			                    <RangedWeapon_Cooldown>1.8</RangedWeapon_Cooldown>
		                    </statBases>
		                    <costList>
		                    	<Steel>100</Steel>
		                    	<ComponentIndustrial>5</ComponentIndustrial>
		                    </costList>
                            <recipeMaker>
                                <skillRequirements>
                                    <Crafting>2</Crafting>
                                </skillRequirements>
                            </recipeMaker>
		                    <weaponTags>
			                    <li>Light_Weps</li>							
                                <li>CE_AI_Rifle</li>
                                <li>EliteGun</li>
		                    </weaponTags>
						    <verbs>
						        <li Class="CombatExtended.VerbPropertiesCE">
                                    <recoilAmount>1.32</recoilAmount>
                                    <verbClass>CombatExtended.Verb_ShootCE</verbClass>
                                    <hasStandardCommand>true</hasStandardCommand>
                                    <defaultProjectile>Bullet_762x39mmSoviet_FMJ</defaultProjectile>           
                                    <warmupTime>0.26</warmupTime>
                                    <range>30</range>
                                    <burstShotCount>300</burstShotCount>
                                    <ticksBetweenBurstShots>1</ticksBetweenBurstShots>
                                    <soundCast>BurstCannon_Fire</soundCast>
                                    <soundCastTail>GunTail_Heavy</soundCastTail>
                                    <muzzleFlashScale>10</muzzleFlashScale>
						        </li>
						    </verbs>
						    <comps>
                                <!-- Leaving this here in case of weapon ammo limits. -->
							    <!--li Class="CombatExtended.CompProperties_AmmoUser">
                                    <magazineSize>220</magazineSize>
                                    <reloadTime>0.25</reloadTime>
                                    <ammoSet>AmmoSet_762x39mmSoviet</ammoSet>
							    </li-->
							    <li Class="CombatExtended.CompProperties_FireModes">
                                    <aiUseBurstMode>TRUE</aiUseBurstMode>
                                    <noSingleShot>true</noSingleShot>  
                                    <aimedBurstShotCount>300</aimedBurstShotCount> 
							    </li>
						    </comps>	
					    </ThingDef>
				    </value>
			    </li>
            </operations>
        </match>
    </Operation>
</Patch>